
❯ ./cow.py
16:16:47: *** 子プロセス生成前 ***
              total        used        free      shared  buff/cache   available
Mem:        2010468     1109996      169000       23708      731472      708908
Swap:       1190340      326300      864040
親プロセスのメモリ関連情報
  RSS  MAJFL  MINFL
112308     0  27418

16:16:49: *** 子プロセス生成直後 ***
              total        used        free      shared  buff/cache   available
Mem:        2010468     1113428      167264       22012      729776      707172
Swap:       1190340      326300      864040
子プロセスのメモリ関連情報
  RSS  MAJFL  MINFL
110880     0    667

16:16:52: *** 子プロセスによるメモリアクセス後 ***
              total        used        free      shared  buff/cache   available
Mem:        2010468     1213492       66800       22412      730176      606708
Swap:       1190340      326300      864040
子プロセスのメモリ関連情報
  RSS  MAJFL  MINFL
110956     0  26721


❯ sar -r 1
Linux 5.15.0-130-generic (howlinuxworks)        01/11/2025      _x86_64_        (4 CPU)

04:16:44 PM kbmemfree   kbavail kbmemused  %memused kbbuffers  kbcached  kbcommit   %commit  kbactive   kbinact   kbdirty
# 子プロセス生成前
04:16:46 PM    276360    816244    923916     45.96     17056    641260   8879456    277.41    480288    999832         0
04:16:47 PM    274852    814760    925400     46.03     17080    641260   8878324    277.38    480304   1000392        28
04:16:48 PM    170024    709932   1032028     51.33     17080    639460   8983404    280.66    480316   1107224        28
# 子プロセス生成直後
04:16:49 PM    169276    709184   1032656     51.36     17080    639564   8984536    280.70    480308   1107380        28
04:16:50 PM    167264    707172   1034688     51.47     17080    639564   9091312    284.03    480344   1109704        28
04:16:51 PM    167264    707172   1034268     51.44     17080    639964   9090580    284.01    480312   1109800        28
# 子プロセスによるメモリアクセス後
04:16:52 PM     67556    607464   1133976     56.40     17080    639964   9090472    284.01    480312   1212092        28
04:16:53 PM     64792    604708   1136716     56.54     17088    639964   9091604    284.04    480332   1212272        32


for ((i=0;i<1000;i++)) ; do ./inc.sh ; done

for ((i=0;i<1000;i++)) ; do ./inc.sh & done; for ((i=0;i<1000;i++)); do wait; done

for ((i=0;i<1000;i++)) ; do ./inc-wrong-lock.sh & done; for ((i=0;i<1000;i++)); do wait; done

for ((i=0;i<1000;i++)) ; do ./inc-lock.sh & done; for ((i=0;i<1000;i++)); do wait; done
